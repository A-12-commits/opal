# Opal Build Tools

## Downloads

The Opal runtime and corelib are distributed here, and are required to
run any code generated by opal.

[Opal version 0.3.21](http://opalrb.org/opal.js) _(13.1kb Minified And Gzipped)_

## Installation

Opal should be added to your Gemfile:

```ruby
gem "opal"
```

## Usage

The easiest way to use opal is to create a rake task using the
`RakeTask` helper class. Assuming you have a single ruby file in
your Opal app called `app.rb`:

```ruby
# app.rb
puts "Hello world"
```

Then create a rake task similar to:

```ruby
# Rakefile
require 'opal/rake_task'

Opal::RakeTask.new do |t|
  t.files = ['app.rb']
end
```

### Building the app

Building the app is as simple as running:

```
rake opal:build
```

This will build all your listed files into `build/app_name.js`. The
output name is based on the directory name. This can be overriden by
setting the `.name` property in the task:

```ruby
Opal::RakeTask.new do |t|
  t.files = ['app.rb']
  t.name  = 'my_awesome_app'
end
```

### Building opal runtime

To run the app in the browser, the opal runtime is required. This can
be built using:

```
rake opal:dependencies
```

Which will build `opal.js` into `./build`.

The output directory can also be overriden inside the rake task:

```ruby
Opal::RakeTask.new do |t|
  t.files = ['app.rb']
  t.build_dir = 'out_dir'
end
```

The output directory will be created if it doesn't exist.

### Running the app

The two compiled files need to be added to a html page so that they
can run in the browser:

```html
<!doctype html>
<html>
<head>
  <title>My awesome Opal app</title>

  <script src="build/opal.js"></script>
  <script src="build/my_awesome_app.js"></script>

  <script>
    // Run opal app
    Opal.require('app')
  </script>
</head>
<body>
</body>
</html>
```

If you open the html file, observe the console and you should see
`"Hello World"` printed to the console.

It is necessary to run `Opal.require('app')` as all files built for
opal are registered so that they can be required inside the ruby
code.

### Adding dependencies

The `opal:dependencies` rake task above can be used to build gems which
are designed to run in the browser. `opal-dom` is a gem that given opal
access to the DOM in the browser.

`opal-dom` first needs to be installed as a gem (currently it is only
available from git):

```ruby
# Gemfile
gem "opal"
gem "opal-dom", :git => 'git://github.com/adambeynon/opal-dom.git'
```

Then add it to the dependencies to build:

```ruby
Opal::RakeTask.new do |t|
  t.files = ['app.rb']
  t.dependencies = ['opal-dom']
end
```

Running `rake opal:dependencies` now will also build
`build/opal-dom.js`.

We can now update our application code:

```ruby
# app.rb
require 'opal-dom'

alert "Hello!"
```

And rebuild:

```
rake opal:build
```

And add `opal-dom` to the html page:

```html
<script src="build/opal.js"></script>
<script src="build/opal-dom.js"></script>
<script src="build/app.js"></script>
```

Now running the app should cause an alert box to display.